import{R as u,j as e,B as p,P as E,K as U,S as H,U as B,T as C,a as S,b as z,C as A,c as D,d as F,e as y,r as g,f as O,g as $,h as J,i as f,k as K,l as W,A as G,m as X,n as R,o as Y,X as Q,p as T,q as V,D as Z,s as _,t as q,u as I,v as ee,w as se,x as re,y as te,z as ae,E as oe,F as ne,L as ie}from"./index-CyLUfu9S.js";const le=u.memo(function({items:o}){const c=n=>{switch(n){case"role":return H;case"entitlement":return U;default:return E}},a=n=>{switch(n){case"role":return"Role";case"entitlement":return"Entitlement";default:return"Application"}};return e.jsx("div",{className:"space-y-2",children:o.map((n,d)=>{const h=c(n.type);return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-md transition-colors duration-150",style:{backgroundColor:"var(--accent)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-md flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--primary)",opacity:.1},children:e.jsx(h,{className:"w-4 h-4",style:{color:"var(--primary)"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"truncate",style:{fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-medium)",color:"var(--text)"},children:n.name}),n.scope&&e.jsxs("div",{className:"truncate",style:{fontSize:"var(--text-xs)",color:"var(--muted-foreground)"},children:["Scope: ",n.scope]})]})]}),e.jsx(p,{variant:"outline",className:"ml-2 flex-shrink-0",style:{fontSize:"var(--text-xs)",borderColor:"var(--border)",color:"var(--muted-foreground)"},children:a(n.type)})]},d)})})}),ce=u.memo(function({peerCoverage:o,lastUsed:c,usageData:a}){const n=u.useMemo(()=>{if(!a||a.length===0)return null;const d=Math.max(...a,1),h=a.map((v,t)=>{const i=t/(a.length-1)*100,r=100-v/d*100;return`${i},${r}`}).join(" ");return e.jsx("svg",{viewBox:"0 0 100 24",className:"w-20 h-6",preserveAspectRatio:"none",style:{display:"block"},children:e.jsx("polyline",{points:h,fill:"none",stroke:"var(--primary)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})},[a]);return e.jsxs("div",{className:"space-y-4",children:[o!==void 0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4",style:{color:"var(--muted-foreground)"}}),e.jsx("span",{style:{fontSize:"var(--text-sm)",color:"var(--text)"},children:"Peer Coverage"}),e.jsx(C,{children:e.jsxs(S,{children:[e.jsx(z,{asChild:!0,children:e.jsx("button",{className:"inline-flex","aria-label":"What is peer coverage?",children:e.jsx(A,{className:"w-3.5 h-3.5",style:{color:"var(--muted-foreground)"}})})}),e.jsx(D,{children:e.jsx("p",{className:"max-w-xs",children:"Percentage of peers in the same department who have similar access"})})]})})]}),e.jsxs("span",{style:{fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-semibold)",color:"var(--primary)"},children:[o,"%"]})]}),e.jsx(F,{value:o,className:"h-2",style:{backgroundColor:"var(--accent)"}}),e.jsx("p",{style:{fontSize:"var(--text-xs)",color:"var(--muted-foreground)"},children:o>=80?"High alignment with peer group":o>=50?"Moderate peer alignment":"Low peer alignment"})]}),c&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4",style:{color:"var(--muted-foreground)"}}),e.jsx("span",{style:{fontSize:"var(--text-sm)",color:"var(--text)"},children:"Last Used"}),e.jsx(C,{children:e.jsxs(S,{children:[e.jsx(z,{asChild:!0,children:e.jsx("button",{className:"inline-flex","aria-label":"How is last used calculated?",children:e.jsx(A,{className:"w-3.5 h-3.5",style:{color:"var(--muted-foreground)"}})})}),e.jsx(D,{children:e.jsx("p",{className:"max-w-xs",children:"Based on authentication logs and system access records"})})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[n,e.jsx("span",{style:{fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-medium)",color:"var(--text)"},children:c})]})]})]})}),de=u.memo(function({recommendations:o,onApply:c,appliedIds:a=[]}){const[n,d]=g.useState(new Set(a)),h=(t,i)=>{const r=new Set(n);i?(r.add(t),c(t)):r.delete(t),d(r)},v=t=>t>=90?"var(--success)":t>=70?"var(--primary)":"var(--warning)";return e.jsx("div",{className:"space-y-3",children:o.map(t=>{const i=n.has(t.id);return e.jsx("div",{className:"p-3 rounded-md transition-all duration-150",style:{backgroundColor:i?"var(--success-bg)":"var(--bg)",border:`1px solid ${i?"var(--success-border)":"var(--border)"}`},children:e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{style:{fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-medium)",color:"var(--text)"},children:t.title}),e.jsxs(p,{variant:"outline",className:"px-1.5 py-0 h-5 gap-1",style:{borderColor:v(t.confidence),color:v(t.confidence),fontSize:"var(--text-xs)"},children:[e.jsx(O,{className:"w-3 h-3"}),t.confidence,"%"]})]}),e.jsx("p",{style:{fontSize:"var(--text-xs)",color:"var(--text-secondary)",lineHeight:"var(--line-height-relaxed)"},children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[i&&e.jsx($,{className:"w-4 h-4",style:{color:"var(--success)"}}),e.jsx(J,{checked:i,onCheckedChange:r=>h(t.id,r),"aria-label":`Apply recommendation: ${t.title}`})]})]})},t.id)})})}),me=u.memo(function({steps:o,collapsible:c=!0}){const[a,n]=g.useState(!1),d=u.useMemo(()=>o.filter(r=>r.status==="completed"),[o]),h=u.useMemo(()=>o.filter(r=>r.status!=="completed"),[o]),v=r=>{switch(r){case"completed":return R;case"current":return y;default:return Y}},t=r=>{switch(r){case"completed":return"var(--success)";case"current":return"var(--primary)";default:return"var(--muted-foreground)"}},i=(r,m,j)=>{const w=v(r.status);return e.jsxs("div",{className:"flex gap-3 relative",children:[!j&&e.jsx("div",{className:"absolute left-5 top-12 bottom-0 w-0.5",style:{backgroundColor:r.status==="completed"?"var(--success)":"var(--border)",opacity:r.status==="completed"?.3:1}}),e.jsx(G,{className:"w-10 h-10 border-2 relative z-10",style:{borderColor:t(r.status)},children:e.jsx(X,{style:{backgroundColor:r.status==="pending"?"var(--surface)":r.status==="completed"?"var(--success-bg)":"var(--info-bg)",color:t(r.status),fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-semibold)"},children:r.user==="System"?e.jsx(w,{className:"w-4 h-4"}):r.user.split(" ").map(b=>b[0]).join("").slice(0,2)})}),e.jsxs("div",{className:"flex-1 min-w-0 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("h4",{style:{fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-semibold)",color:"var(--text)"},children:r.title}),r.status==="completed"&&e.jsx(R,{className:"w-4 h-4 flex-shrink-0",style:{color:"var(--success)"}}),r.status==="current"&&e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0 animate-pulse",style:{backgroundColor:"var(--primary)"}})]}),e.jsx("p",{style:{fontSize:"var(--text-sm)",color:"var(--text-secondary)",marginBottom:"4px"},children:r.user}),r.timestamp&&e.jsxs("div",{className:"flex items-center gap-1.5",style:{color:"var(--muted-foreground)"},children:[e.jsx(y,{className:"w-3 h-3"}),e.jsx("span",{style:{fontSize:"var(--text-xs)"},children:r.timestamp})]}),r.eta&&r.status==="current"&&e.jsxs("div",{className:"inline-flex items-center gap-1.5 mt-2 px-2 py-1 rounded",style:{backgroundColor:"var(--info-bg)",border:"1px solid var(--info-border)"},children:[e.jsx(y,{className:"w-3 h-3",style:{color:"var(--info)"}}),e.jsxs("span",{style:{fontSize:"var(--text-xs)",color:"var(--info)",fontWeight:"var(--font-weight-medium)"},children:["ETA: ",r.eta]})]})]})]},r.id)};return e.jsxs("div",{children:[c&&d.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>n(!a),className:"h-8 gap-2 -ml-2 mb-2",style:{color:"var(--muted-foreground)"},children:[a?e.jsx(K,{className:"w-4 h-4"}):e.jsx(W,{className:"w-4 h-4"}),d.length," completed step",d.length>1?"s":""]}),a&&e.jsx("div",{className:"space-y-0",children:d.map((r,m)=>i(r,m,m===d.length-1&&h.length===0))})]}),e.jsx("div",{className:"space-y-0",children:h.map((r,m)=>i(r,m,m===h.length-1))})]})});function he({request:s,open:o,onClose:c,onApprove:a,onReject:n,onDelegate:d}){const[h,v]=g.useState(!1),[t,i]=g.useState(!1),[r,m]=g.useState(!1),[j,w]=g.useState([]);if(g.useEffect(()=>{if(!o||!s)return;const x=l=>{l.target instanceof HTMLInputElement||l.target instanceof HTMLTextAreaElement||(l.key==="a"||l.key==="A"?(l.preventDefault(),a(s.id)):l.key==="r"||l.key==="R"?(l.preventDefault(),i(!0)):(l.key==="d"||l.key==="D")&&(l.preventDefault(),m(!0)))};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[o,s?.id,a]),!o||!s)return null;const b=x=>{switch(x){case"Critical":return"var(--danger)";case"High":return"var(--warning)";case"Medium":return"var(--info)";default:return"var(--success)"}},M=x=>e.jsx(T,{className:"w-3 h-3"}),P=u.useMemo(()=>[{id:"1",status:"completed",title:"Request Submitted",user:s.requester.name,timestamp:s.submittedAt},{id:"2",status:"completed",title:"Manager Approved",user:"Sarah Chen",timestamp:"2 hours ago"},{id:"3",status:"current",title:"App Owner Review",user:"You",timestamp:"In Progress",eta:"4 hours"},{id:"4",status:"pending",title:"Provisioning",user:"System",timestamp:void 0}],[s.requester.name,s.submittedAt]),N=u.useMemo(()=>[{id:"rec-1",title:"Reduce scope to Read-only",description:"Lower risk while maintaining essential access based on peer usage patterns",confidence:92,type:"scope"},{id:"rec-2",title:"Time-bound access (7 days)",description:"Grant temporary access with automatic revocation for short-term needs",confidence:85,type:"duration"}],[]),k=s.status==="Pending"?"2d left":null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40 transition-opacity duration-150",onClick:c,style:{backdropFilter:"blur(2px)"}}),e.jsxs("div",{className:"fixed right-0 top-0 bottom-0 w-full max-w-[560px] z-50 flex flex-col overflow-hidden transition-transform duration-150",style:{backgroundColor:"var(--bg)",boxShadow:"var(--shadow-xl)"},children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between sticky top-0 z-10",style:{borderColor:"var(--border)",backgroundColor:"var(--bg)",boxShadow:"var(--shadow-sm)"},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap flex-1 min-w-0",children:[e.jsx("h2",{className:"flex-shrink-0",style:{fontSize:"var(--text-lg)",fontWeight:"var(--font-weight-semibold)",color:"var(--text)"},children:s.id}),e.jsx(p,{variant:"outline",className:"flex-shrink-0",style:{borderColor:s.status==="Pending"?"var(--warning)":"var(--border)",color:s.status==="Pending"?"var(--warning)":"var(--text)",fontSize:"var(--text-xs)"},children:s.status}),e.jsxs(p,{variant:"outline",className:"gap-1 flex-shrink-0",style:{borderColor:b(s.risk),color:b(s.risk),fontSize:"var(--text-xs)"},children:[M(s.risk),s.risk]}),k&&e.jsx(p,{variant:"outline",className:"flex-shrink-0",style:{borderColor:"var(--info-border)",backgroundColor:"var(--info-bg)",color:"var(--info)",fontSize:"var(--text-xs)"},children:k}),j.map(x=>{const l=N.find(L=>L.id===x);return l?e.jsx(p,{className:"flex-shrink-0",style:{backgroundColor:"var(--success-bg)",borderColor:"var(--success-border)",color:"var(--success)",fontSize:"var(--text-xs)"},children:l.title},x):null})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:c,className:"h-8 w-8 flex-shrink-0 ml-2",children:e.jsx(Q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 space-y-6",children:[s.sodConflicts>0&&e.jsxs("div",{className:"p-4 rounded-lg border flex items-start gap-3",style:{backgroundColor:"var(--warning-bg)",borderColor:"var(--warning-border)"},children:[e.jsx(T,{className:"w-5 h-5 flex-shrink-0 mt-0.5",style:{color:"var(--warning)"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h4",{className:"mb-1",style:{fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-semibold)",color:"var(--text)"},children:[s.sodConflicts," Segregation of Duties Conflict",s.sodConflicts>1?"s":""]}),e.jsx("p",{className:"mb-3",style:{fontSize:"var(--text-sm)",color:"var(--text-secondary)",lineHeight:"var(--line-height-relaxed)"},children:"This request conflicts with existing access. Review required before approval."}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>v(!0),children:"Review Conflicts"})]})]}),e.jsxs("div",{className:"p-5 rounded-lg border",style:{backgroundColor:"var(--surface)",borderColor:"var(--border)",boxShadow:"var(--shadow-sm)"},children:[e.jsx("h3",{className:"mb-4",style:{fontSize:"var(--text-body)",fontWeight:"var(--font-weight-semibold)",color:"var(--text)"},children:"Request Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",style:{fontSize:"var(--text-xs)",color:"var(--muted-foreground)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Requester"}),e.jsx("div",{style:{fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-medium)",color:"var(--text)"},children:s.requester.name}),e.jsx("div",{style:{fontSize:"var(--text-xs)",color:"var(--muted-foreground)"},children:s.requester.department})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",style:{fontSize:"var(--text-xs)",color:"var(--muted-foreground)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Item"}),e.jsx("div",{style:{fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-medium)",color:"var(--text)"},children:s.item.name}),e.jsx("div",{style:{fontSize:"var(--text-xs)",color:"var(--muted-foreground)"},children:s.item.type})]}),s.item.scope&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",style:{fontSize:"var(--text-xs)",color:"var(--muted-foreground)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Scope"}),e.jsx("div",{style:{fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-medium)",color:"var(--text)"},children:s.item.scope})]}),s.duration&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",style:{fontSize:"var(--text-xs)",color:"var(--muted-foreground)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Duration"}),e.jsx("div",{style:{fontSize:"var(--text-sm)",fontWeight:"var(--font-weight-medium)",color:"var(--text)"},children:s.duration})]})]}),s.impactItems&&s.impactItems.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"my-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-3",style:{fontSize:"var(--text-xs)",color:"var(--muted-foreground)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Impact Preview"}),e.jsx(le,{items:s.impactItems})]})]})]}),e.jsxs("div",{className:"p-5 rounded-lg border",style:{backgroundColor:"var(--surface)",borderColor:"var(--border)",boxShadow:"var(--shadow-sm)"},children:[e.jsx("h3",{className:"mb-4",style:{fontSize:"var(--text-body)",fontWeight:"var(--font-weight-semibold)",color:"var(--text)"},children:"Approval Workflow"}),e.jsx(me,{steps:P})]}),(s.peerCoverage!==void 0||s.lastUsed)&&e.jsxs("div",{className:"p-5 rounded-lg border",style:{backgroundColor:"var(--surface)",borderColor:"var(--border)",boxShadow:"var(--shadow-sm)"},children:[e.jsx("h3",{className:"mb-4",style:{fontSize:"var(--text-body)",fontWeight:"var(--font-weight-semibold)",color:"var(--text)"},children:"Usage Intelligence"}),e.jsx(ce,{peerCoverage:s.peerCoverage,lastUsed:s.lastUsed,usageData:s.usageData})]}),e.jsxs("div",{className:"p-5 rounded-lg border",style:{backgroundColor:"var(--surface)",borderColor:"var(--border)",boxShadow:"var(--shadow-sm)"},children:[e.jsx("h3",{className:"mb-3",style:{fontSize:"var(--text-body)",fontWeight:"var(--font-weight-semibold)",color:"var(--text)"},children:"Business Justification"}),e.jsx("p",{style:{fontSize:"var(--text-sm)",color:"var(--text-secondary)",lineHeight:"var(--line-height-relaxed)"},children:s.businessJustification})]}),e.jsxs("div",{className:"p-5 rounded-lg border",style:{backgroundColor:"var(--info-bg)",borderColor:"var(--info-border)",boxShadow:"var(--shadow-sm)"},children:[e.jsx("h3",{className:"mb-3",style:{fontSize:"var(--text-body)",fontWeight:"var(--font-weight-semibold)",color:"var(--text)"},children:"AI Recommendations"}),e.jsx("p",{className:"mb-4",style:{fontSize:"var(--text-xs)",color:"var(--text-secondary)"},children:"Based on similar requests and risk analysis"}),e.jsx(de,{recommendations:N,onApply:x=>{w([...j,x])},appliedIds:j})]})]}),s.status==="Pending"&&e.jsx("div",{className:"border-t px-6 py-4 flex items-center gap-3 sticky bottom-0",style:{borderColor:"var(--border)",backgroundColor:"var(--bg)",boxShadow:"var(--shadow-lg)"},children:e.jsxs("div",{className:"flex-1 flex items-center gap-2 justify-end",children:[e.jsxs(f,{variant:"outline",onClick:()=>m(!0),className:"gap-2",children:["Delegate",e.jsx("kbd",{className:"px-1.5 py-0.5 rounded border text-[10px]",style:{backgroundColor:"var(--surface)",borderColor:"var(--border)",color:"var(--muted-foreground)"},children:"D"})]}),e.jsxs(f,{variant:"outline",onClick:()=>i(!0),className:"gap-2",style:{borderColor:"var(--danger)",color:"var(--danger)"},children:["Reject",e.jsx("kbd",{className:"px-1.5 py-0.5 rounded border text-[10px]",style:{backgroundColor:"var(--surface)",borderColor:"var(--danger)",color:"var(--danger)"},children:"R"})]}),e.jsxs(Z,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(f,{className:"gap-2",style:{backgroundColor:"var(--success)",color:"white"},children:["Approve",e.jsx(W,{className:"w-4 h-4"}),e.jsx("kbd",{className:"px-1.5 py-0.5 rounded border text-[10px]",style:{backgroundColor:"rgba(255,255,255,0.2)",borderColor:"rgba(255,255,255,0.3)",color:"white"},children:"A"})]})}),e.jsxs(q,{align:"end",children:[e.jsx(I,{onClick:()=>a(s.id),children:"Approve as requested"}),e.jsx(I,{onClick:()=>a(s.id,!0),children:"Approve with changes"})]})]})]})})]}),e.jsx(ee,{open:h,onOpenChange:v,requestId:s.id,conflicts:[{id:"1",conflictingAccess:"Finance Approver + Purchasing Admin",reason:"User cannot both approve and create purchase orders",policy:"SOD-FIN-001",policyLink:"#"},{id:"2",conflictingAccess:"AWS Production Admin + Database Admin",reason:"Excessive combined privileges in production environment",policy:"SOD-INF-002",policyLink:"#"}]}),e.jsx(se,{open:t,onOpenChange:i,onConfirm:x=>{n(s.id,x),i(!1),c()},requestId:s.id}),e.jsx(re,{open:r,onOpenChange:m,children:e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsx(oe,{children:"Delegate Approval"}),e.jsx(ne,{children:"Select a user to delegate this approval request to"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:"Delegate to"}),e.jsxs("select",{className:"w-full h-10 px-3 rounded-md border",style:{backgroundColor:"var(--input-background)",borderColor:"var(--border)",fontSize:"var(--text-sm)"},children:[e.jsx("option",{children:"Sarah Chen - Manager"}),e.jsx("option",{children:"James Wilson - Tech Lead"}),e.jsx("option",{children:"Maria Garcia - Security"})]})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(f,{onClick:()=>{d(s.id),m(!1),c()},children:"Delegate"})]})]})})]})}export{he as EnhancedApprovalDrawer};
